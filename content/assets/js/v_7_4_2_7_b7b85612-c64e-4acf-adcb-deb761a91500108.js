import{Q as w,R as S,aj as b,aq as v}from"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a9150023.js";import{r as C}from"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a9150010.js";import{c as A}from"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a915007.js";function f(a){return new Promise((c,e)=>{a.oncomplete=a.onsuccess=()=>c(a.result),a.onabort=a.onerror=()=>e(a.error)})}function h(a,c){let e;const i=()=>{if(e)return e;const r=indexedDB.open(a);return r.onupgradeneeded=()=>r.result.createObjectStore(c),e=f(r),e.then(t=>{t.onclose=()=>e=void 0},()=>{}),e};return(r,t)=>i().then(o=>t(o.transaction(c,r).objectStore(c)))}let p;function y(){return p||(p=h("keyval-store","keyval")),p}function I(a,c=y()){return c("readonly",e=>f(e.get(a)))}function k(a,c,e=y()){return e("readwrite",i=>(i.put(c,a),f(i.transaction)))}function x(a,c=y()){return c("readwrite",e=>(e.delete(a),f(e.transaction)))}var g=function(a,c,e,i){function r(t){return t instanceof e?t:new e(function(o){o(t)})}return new(e||(e=Promise))(function(t,o){function u(s){try{n(i.next(s))}catch(l){o(l)}}function d(s){try{n(i.throw(s))}catch(l){o(l)}}function n(s){s.done?t(s.value):r(s.value).then(u,d)}n((i=i.apply(a,c||[])).next())})},m=function(a,c){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},i,r,t,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=u(0),o.throw=u(1),o.return=u(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(n){return function(s){return d([n,s])}}function d(n){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,n[0]&&(e=0)),e;)try{if(i=1,r&&(t=n[0]&2?r.return:n[0]?r.throw||((t=r.return)&&t.call(r),0):r.next)&&!(t=t.call(r,n[1])).done)return t;switch(r=0,t&&(n=[n[0]&2,t.value]),n[0]){case 0:case 1:t=n;break;case 4:return e.label++,{value:n[1],done:!1};case 5:e.label++,r=n[1],n=[0];continue;case 7:n=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(n[0]===6||n[0]===2)){e=0;continue}if(n[0]===3&&(!t||n[1]>t[0]&&n[1]<t[3])){e.label=n[1];break}if(n[0]===6&&e.label<t[1]){e.label=t[1],t=n;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(n);break}t[2]&&e.ops.pop(),e.trys.pop();continue}n=c.call(a,e)}catch(s){n=[6,s],r=0}finally{i=t=0}if(n[0]&5)throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}},D=function(a,c){var e=h(a,c);return{getItem:function(i){return g(void 0,void 0,void 0,function(){var r,t;return m(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,I(i,e)];case 1:return r=o.sent(),[2,r?JSON.stringify(r):null];case 2:return t=o.sent(),console.error("[".concat(a,"] Erro ao ler '").concat(i,"':"),t),[2,null];case 3:return[2]}})})},setItem:function(i,r){return g(void 0,void 0,void 0,function(){var t,o;return m(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),t=JSON.parse(r),[4,k(i,t,e)];case 1:return u.sent(),[3,3];case 2:return o=u.sent(),console.error("[".concat(a,"] Erro ao salvar '").concat(i,"':"),o),[3,3];case 3:return[2]}})})},removeItem:function(i){return g(void 0,void 0,void 0,function(){var r;return m(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,x(i,e)];case 1:return t.sent(),[3,3];case 2:return r=t.sent(),console.error("[".concat(a,"] Erro ao remover '").concat(i,"':"),r),[3,3];case 3:return[2]}})})}}};const M=A()(w((a,c)=>({currentCampaignId:"",setCurrentCampaignId:e=>a({currentCampaignId:e}),campaigns:[],addCampaign:e=>{if(c().campaigns.some(t=>t.id===e.id)){console.warn(`Campanha com ID ${e.id} jÃ¡ existe`);return}a(t=>({campaigns:[...t.campaigns,{...e,createdAt:e.createdAt||new Date,updatedAt:e.updatedAt||new Date}]}))},updateCampaign:(e,i)=>a(r=>({campaigns:r.campaigns.map(t=>t.id===e?{...t,...i,updatedAt:new Date}:t)})),updateConfig:(e,i)=>a(r=>({campaigns:r.campaigns.map(t=>t.id===e?{...t,config:{...t.config,...i},updatedAt:new Date}:t)})),removeCampaign:e=>a(i=>({campaigns:i.campaigns.filter(r=>r.id!==e)})),clearCampaigns:()=>a({campaigns:[]}),setQuickReplyAction:e=>{const{currentCampaignId:i,campaigns:r}=c();if(!i||!r.find(s=>s.id===i))return;const{getAction:o}=b.getState(),{acao:u}=v.getState(),n=(Array.isArray(e.script)&&e.type==="script"?e.script.flatMap(s=>o(s.id)??[]):o(e.id)??[]).map(s=>({...s,id:C()}));v.setState({acao:[...u,...n]})}}),{name:"useSendBulkMessage-store",storage:S(()=>D("SendBulkMessageDB","useSendBulkMessageStore"),{reviver:(a,c)=>{if(typeof c=="string"&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/.test(c)){const e=new Date(c);return isNaN(e.getTime())?c:e}return c}}),version:1,partialize:a=>({campaigns:a.campaigns,currentCampaignId:a.currentCampaignId})}));export{D as C,M as u};
