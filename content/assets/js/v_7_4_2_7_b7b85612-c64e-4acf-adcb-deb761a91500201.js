import{j as e,z as I,I as j,cB as P,_ as z,K as w,ba as E,Q as M,X as _}from"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a9150010.js";import{a as f}from"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a915004.js";import{n as A,o as k}from"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a9150023.js";import{u as N}from"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a9150019.js";import{W as B,V as F}from"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a9150018.js";import{c as L}from"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a915007.js";import{w as D,x as R}from"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a915008.js";import{C as U}from"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a91500117.js";import"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a91500.js";import"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a915006.js";import"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a915009.js";import"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a915005.js";import"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a915002.js";import"./v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a915003.js";function V({colunas:i,resolve:t}){const{close:r}=A(),d=()=>{t(!1)};f.useEffect(()=>d,[]);const{language:c}=N(),n=a=>{t(a),r()};return e.jsxs("div",{className:"max-w-[80vw] max-h-[80vh] min-h-[305px]",children:[e.jsx(I,{children:c.colunaComNumeros}),e.jsxs("span",{className:"text-lg text-[var(--primary)]",children:[c.naoFoiPossivelColunaComNumeros,",",e.jsx("strong",{children:c.numbers}),",",c.selecioneManualmenteAColuna]}),e.jsx("div",{className:"p-4 flex flex-wrap gap-4 max-h-[80vh] overflow-y-auto",children:Object.values(i).map(a=>{if(a[0]!==void 0)return e.jsxs("div",{className:"shadow-sm w-fit hover:border-[var(--primaria)] hover:border hover:border-solid pulse cursor-pointer rounded-lg max-w-80",onClick:()=>n(a),children:[e.jsx("div",{className:"bg-[var(--primaria)] text-[var(--letra)] text-center rounded-t-lg font-bold p-1 whitespace-nowrap text-ellipsis overflow-hidden",children:a[0]}),e.jsx("div",{className:"flex flex-col bg-base-200 p-1 rounded-b-lg max-h-[300px] overflow-y-auto gap-1",children:a.slice(1,10).map((x,m)=>e.jsx("span",{className:"whitespace-nowrap text-ellipsis overflow-hidden",children:x}))})]})})})]})}function q(){const{loading:i}=y(),{language:t}=N();return e.jsxs("div",{className:"flex flex-col justify-center gap-4 w-[320px] items-center",children:[e.jsx("div",{className:"radial-progress text-[var(--primaria)] text-center",id:"progress",style:{"--value":i.porcentagem,"--size":"12rem","--thickness":"6px"},children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("span",{className:"pulse",children:[i.porcentagem,"%"]}),e.jsx("span",{className:"pulse",children:i.contador})]})}),e.jsxs("div",{className:"loading-animate animate__animated animate__jackInTheBox",children:[e.jsx("div",{className:"loading-name p-1",children:t.aguarde}),e.jsx("div",{className:"circle"}),e.jsx("div",{className:"circle"}),e.jsx("div",{className:"circle"})]})]})}const y=L()(i=>({file:null,options:{internacional:!1,ninthDigit:!1,validar:!1},loading:{porcentagem:"0%",contador:"0"},updateOptions:(t,r,d)=>i(c=>({options:{...c.options,[d]:!1,[t]:r}})),atualizarOptions:(t,r)=>i(d=>({options:{...d.options,[t]:r}})),setFile:t=>i({file:t}),extrairColunas:()=>new Promise((t,r)=>{const{file:d}=y.getState(),c=new FileReader;c.onload=async n=>{var a;const p=(a=n.target)==null?void 0:a.result;if(p){const x=new Uint8Array(p).reduce((m,u)=>m+String.fromCharCode(u),"");try{const m=await fetch(`${F.backend_utils}api/XLSX/processPlanilha`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:btoa(x)})});if(!m.ok){r("Erro ao processar a planilha no servidor");return}const u=await m.json();t(u.colunas)}catch{r("Erro ao processar a planilha no servidor")}}},c.readAsArrayBuffer(d)}),capturarContatos:async()=>{const{extrairColunas:t,options:r,updateLoading:d}=y.getState(),{open:c,close:n}=A.getState(),{language:p}=N.getState();let a=await t();const x=[],m=["NUMEROS","NUMERO","NÚMERO","NÚMEROS","PHONE","PHONES","WHATSAPP"];let u=Object.values(a).filter((s,o)=>{if(s[0]&&m.includes(s[0].toString().toUpperCase().replaceAll(" ","")))return s});const C=["NOMES","NOME","NAMES","NAME"],g=Object.values(a).filter((s,o)=>{if(s[0]&&C.includes(s[0].toString().toUpperCase().replaceAll(" ","")))return s});if(u.length===0){j({type:"Info",message:p.planilhaNaoTemColunaNumeros,position:"top-right"});const s=await new Promise((o,l)=>{c(e.jsx(V,{colunas:a,resolve:o}))});if(!s){j({type:"Error",message:p.colunaComNumerosNaoSelecionada,position:"top-right"});return}u=[s]}r.validar&&c(e.jsx(q,{}));for(let[s,o]of Object.entries(u[0])){let l=o;if(d(u[0].length-1,parseInt(s)),l=l.toString().replace(/\D/g,""),!(l.length<8||l.length>17)){if(r.internacional||(l=P.add55(l),r.ninthDigit||(l=P.add9(l))),r.validar&&await B.Contact("queryExists",l)!=="undefined"){let v={id:l.toString(),name:g.length!==0?g[0][parseInt(s)]:l};Object.values(a).filter((h,T)=>{let O=h[parseInt(s)];h[parseInt(s)]!==void 0&&(v[h[0]]=O.toString())}),x.push(v)}else if(!r.validar){let v={id:l.toString(),name:g.length!==0?g[0][parseInt(s)]:l,imported:!0};Object.values(a).filter((h,T)=>{let O=h[parseInt(s)];h[parseInt(s)]!==void 0&&(v[h[0]]=O.toString())}),x.push(v)}}}let b={},S=x.filter(s=>b[s.id]?!1:(b[s.id]=!0,!0));return j({type:"Success",message:p.contatosImportados,position:"top-right"}),n(),i({file:null}),S},updateLoading:(t,r)=>i(()=>({loading:{porcentagem:(r*100/t).toFixed(0).toString(),contador:`${t} / ${r}`}}))})),W=f.lazy(() => __vitePreload(()=>import(chrome.runtime.getURL("content/assets/js/v_7_4_2_7_b7b85612-c64e-4acf-adcb-deb761a91500223.js")),[]));function H(){return e.jsx(f.Suspense,{fallback:e.jsx(e.Fragment,{}),children:e.jsx(W,{})})}const $=({file:i,className:t=""})=>{if(!i||!i.name)return null;const r=N(n=>n.language),d=n=>{var a;switch((a=n==null?void 0:n.split(".").pop())==null?void 0:a.toLowerCase()){case"xlsx":case"xls":return e.jsx(D,{className:"w-5 h-5",style:{color:"var(--primaria)"}});case"csv":return e.jsx(R,{className:"w-5 h-5",style:{color:"var(--primaria)"}});default:return e.jsx(D,{className:"w-5 h-5",style:{color:"var(--primaria)"}})}},c=n=>{if(!n)return"";const p=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(n)/Math.log(1024));return Math.round(n/Math.pow(1024,a)*100)/100+" "+p[a]};return e.jsx("div",{className:`px-3 py-1.5 border-solid border-l-4 bg-neutral-200 dark:bg-neutral-800 shadow-inner rounded-r-lg ${t}`,style:{borderLeftColor:"var(--primaria)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[d(i.name),e.jsxs("div",{children:[e.jsx(w,{children:e.jsx("strong",{style:{color:"var(--primaria)"},children:i.name})}),e.jsx("p",{className:"text-xs font-semibold",children:i.size?c(i.size):r.arquivoCarregadoComSucesso})]})]}),e.jsx("div",{className:"flex items-center space-x-1",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:"var(--primaria)",color:"white"},children:["✓ ",r.pronto]})})]})})};function oe({list:i}){const{open:t}=k(),{file:r,setFile:d,capturarContatos:c,options:n,updateOptions:p}=y(),{language:a,idioma:x}=N(),[m,u]=f.useState(!1);f.useRef(null),f.useRef(null);const C=o=>{t(e.jsx(H,{}),{placement:"top"},o)},g=o=>{o.preventDefault();const l=o.dataTransfer.files[0];l&&l.type.startsWith("application/")?d(l):j({type:"Error",message:a.carregueUmArquivoDoTipo,position:"top-right"})},b=o=>{o.preventDefault()},S=async()=>{if(u(!0),!r){j({type:"Error",message:a.porFavorCarregueUmArquivo,position:"top-right"});return}const o=await c();i(o??[])};return e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{children:a.importarPlanilhas}),e.jsx("span",{className:"pulse cursor-pointer lg:tooltip lg:tooltip-bottom","data-tip":a.asColunasDevemConter,children:e.jsx(E,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex flex-col w-[555px]",children:[e.jsx(w,{weight:"600",children:a.importeOuArrastePlanilha}),e.jsxs(w,{children:[a.vocePodeBaixarUm,e.jsxs("span",{children:[" ",a.model," "]}),a.paraTalDocumento,e.jsx("button",{className:"ml-3 btn-daisy !btn-xs !bg-[var(--primaria)] pulse !text-[var(--letra)]",onClick:o=>C(o.target),children:a.visualizarModelo})]})]}),e.jsxs("div",{className:"flex gap-2 items-center justify-center h-24 w-full",children:[e.jsxs("label",{className:"p-2 border-base-200 hover:border-[var(--primaria)] border border-solid rounded-lg h-full w-20 pulse flex justify-center items-center flex-col shadow-lg cursor-pointer",children:[e.jsx(U,{className:"h-6 w-6 text-[var(--primaria)]",strokeWidth:1}),e.jsx("strong",{className:"text-[var(--primaria)]",children:a.import}),e.jsx("input",{type:"file",accept:".xlsx, .csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv",className:"hidden",onChange:o=>d(o.target.files[0])})]}),e.jsx("div",{className:"border-dashed border-2 border-[var(--primaria)] rounded-lg h-full w-full flex justify-center items-center",onDrop:g,onDragOver:b,children:a.arrasteOArquivoAqui})]}),r&&r.name&&e.jsx($,{file:r}),e.jsxs("div",{className:"pt-3",children:[e.jsx(w,{weight:"600",children:a.DefinaAsConfiguracoesImportacao}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between cursor-pointer items-center hover:bg-[var(--dropdown-background-hover)] h-9 px-1 py-2 rounded",children:[e.jsxs("span",{children:[a.aPlanilhaContemNumeros," ",e.jsx("strong",{children:a.internacionais}),"?"]}),e.jsx(M,{estado:n.internacional,switchUpdate:()=>p("internacional",!n.internacional,"ninthDigit"),id:"internacional"})]}),x==="pt"&&e.jsxs("div",{className:"flex justify-between cursor-pointer items-center hover:bg-[var(--dropdown-background-hover)] h-9 px-1 py-2 rounded",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{children:[a.ignorarValidacaoDo,e.jsx("strong",{children:a.digitoBrasileiro}),"?"]}),e.jsx("span",{className:"pulse cursor-pointer lg:tooltip lg:tooltip-top before:!w-48","data-tip":a.dicaDigitoBrasileiro,children:e.jsx(E,{className:"h-5 w-5"})})]}),e.jsx(M,{estado:n.ninthDigit,switchUpdate:()=>p("ninthDigit",!n.ninthDigit,"internacional"),id:"ninthDigit"})]}),e.jsx("div",{className:"text-center pt-3",children:m?e.jsx("span",{className:"loading loading-spinner loading-md text-[var(--primaria)]"}):e.jsx(_,{name:a.realizarImportacao,funcao:S})})]})]})]})}export{oe as default};
